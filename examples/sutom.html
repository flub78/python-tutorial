<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sutom - Aide √† la r√©solution</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
            padding: 10px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            padding: 15px;
        }

        @media (max-width: 768px) {
            body {
                padding: 5px;
            }
            
            .container {
                padding: 10px;
            }
            
            h1 {
                font-size: 20px;
            }
        }

        h1 {
            text-align: center;
            color: #333;
            margin-bottom: 20px;
        }

        /* Onglets */
        .tabs {
            display: flex;
            border-bottom: 2px solid #4CAF50;
            margin-bottom: 20px;
            gap: 5px;
        }

        .tab {
            padding: 10px 20px;
            background-color: #e0e0e0;
            border: none;
            cursor: pointer;
            font-size: 16px;
            border-radius: 8px 8px 0 0;
            transition: background-color 0.3s;
        }

        .tab:hover {
            background-color: #d0d0d0;
        }

        .tab.active {
            background-color: #4CAF50;
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        @media (max-width: 768px) {
            .tab {
                padding: 8px 12px;
                font-size: 14px;
            }
        }

        .config-section {
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 20px;
            background-color: #fafafa;
        }

        .config-section h2 {
            font-size: 18px;
            margin-bottom: 15px;
            color: #555;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: inline-block;
            width: 150px;
            font-weight: bold;
        }

        .form-group input {
            padding: 8px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-size: 14px;
        }

        @media (max-width: 768px) {
            .form-group {
                margin-bottom: 10px;
            }
            
            .form-group label {
                display: block;
                width: 100%;
                margin-bottom: 5px;
            }
            
            .form-group input[type="file"] {
                width: 100%;
                font-size: 12px;
            }
        }

        button {
            background-color: #4CAF50;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            width: auto;
        }

        button:hover {
            background-color: #45a049;
        }

        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }

        @media (max-width: 768px) {
            button {
                font-size: 14px;
                padding: 8px 16px;
                width: 100%;
            }
        }

        .proposition-section {
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 20px;
            background-color: #fafafa;
        }

        .proposition-section h2 {
            font-size: 18px;
            margin-bottom: 10px;
            color: #555;
        }

        .info-text {
            margin-bottom: 15px;
            color: #666;
            font-size: 14px;
        }

        .lettres-container {
            display: flex;
            justify-content: center;
            gap: 5px;
            margin: 20px 0;
            flex-wrap: wrap;
        }

        .lettre-btn {
            width: 60px;
            height: 60px;
            font-size: 32px;
            font-weight: bold;
            background-color: #e0e0e0;
            border: 3px solid #999;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            color: #333;
        }

        @media (max-width: 768px) {
            .lettres-container {
                gap: 3px;
                margin: 10px 0;
            }
            
            .lettre-btn {
                width: 45px;
                height: 45px;
                font-size: 24px;
                border: 2px solid #999;
            }
        }

        @media (max-width: 480px) {
            .lettre-btn {
                width: 38px;
                height: 38px;
                font-size: 20px;
            }
        }

        .lettre-btn:hover {
            transform: scale(1.05);
        }

        .lettre-btn.bien-placee {
            background-color: #D32F2F;
            color: white;
            border-color: #B71C1C;
        }

        .lettre-btn.mal-placee {
            background-color: #C9B458;
            color: white;
            border-color: #B8A040;
        }

        .lettre-btn.absente {
            background-color: #5B8FDB;
            color: white;
            border-color: #4A7FCA;
        }

        .lettre-btn.edition {
            background-color: white;
            border-color: #4CAF50;
            border-width: 3px;
            box-shadow: 0 0 8px rgba(76, 175, 80, 0.5);
        }

        .lettre-btn input {
            width: 100%;
            height: 100%;
            border: none;
            background: transparent;
            text-align: center;
            font-size: inherit;
            font-weight: inherit;
            text-transform: uppercase;
            color: inherit;
            outline: none;
        }

        .legende-section {
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 15px;
            margin-bottom: 20px;
            background-color: #fafafa;
        }

        .legende-section h2 {
            font-size: 18px;
            margin-bottom: 10px;
            color: #555;
        }

        .legende-container {
            display: flex;
            align-items: center;
            gap: 20px;
            flex-wrap: wrap;
        }

        .legende-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .legende-box {
            width: 30px;
            height: 30px;
            border: 2px solid #666;
            border-radius: 4px;
        }

        .legende-help {
            margin-top: 10px;
            font-size: 12px;
            color: #888;
            font-style: italic;
        }

        @media (max-width: 768px) {
            .legende-container {
                gap: 10px;
            }
            
            .legende-item {
                font-size: 14px;
            }
            
            .legende-box {
                width: 25px;
                height: 25px;
            }
            
            .legende-help {
                font-size: 11px;
            }
        }

        .historique-section {
            border: 1px solid #ddd;
            border-radius: 6px;
            padding: 15px;
            background-color: #fafafa;
        }

        .historique-section h2 {
            font-size: 18px;
            margin-bottom: 10px;
            color: #555;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            background-color: white;
            font-size: 14px;
        }

        th {
            background-color: #4CAF50;
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: bold;
        }

        td {
            padding: 10px;
            border-bottom: 1px solid #ddd;
        }

        tr:hover {
            background-color: #f5f5f5;
        }

        .lettre-historique {
            display: inline-block;
            padding: 2px 6px;
            margin: 0 1px;
            border-radius: 3px;
            font-weight: bold;
        }

        .lettre-historique.bien-placee {
            background-color: #D32F2F;
            color: white;
        }

        .lettre-historique.mal-placee {
            background-color: #C9B458;
            color: white;
        }

        .lettre-historique.absente {
            background-color: #5B8FDB;
            color: white;
        }

        @media (max-width: 768px) {
            table {
                font-size: 12px;
            }
            
            th, td {
                padding: 8px 4px;
            }
            
            th:nth-child(3), td:nth-child(3) {
                display: none;
            }
            
            .lettre-historique {
                padding: 1px 4px;
                margin: 0;
                font-size: 11px;
            }
        }

        @media (max-width: 480px) {
            table {
                font-size: 11px;
            }
            
            th, td {
                padding: 6px 2px;
            }
        }

        .context-menu {
            position: absolute;
            background-color: white;
            border: 1px solid #ccc;
            border-radius: 4px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            padding: 5px 0;
            z-index: 1000;
            min-width: 180px;
        }

        .context-menu-item {
            padding: 10px 20px;
            cursor: pointer;
        }

        .context-menu-item:hover {
            background-color: #f0f0f0;
        }

        .hidden {
            display: none;
        }

        .message {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }

        .message.error {
            background-color: #ffebee;
            color: #c62828;
            border: 1px solid #ef5350;
        }

        .message.success {
            background-color: #e8f5e9;
            color: #2e7d32;
            border: 1px solid #66bb6a;
        }

        .message.info {
            background-color: #e3f2fd;
            color: #1565c0;
            border: 1px solid #42a5f5;
        }

        /* Styles pour le mode jeu */
        .input-mot {
            padding: 10px;
            font-size: 18px;
            text-transform: uppercase;
            border: 2px solid #ccc;
            border-radius: 4px;
            width: 100%;
            max-width: 300px;
            text-align: center;
        }

        .input-lettres-container {
            display: flex;
            justify-content: center;
            gap: 5px;
            margin: 20px 0;
        }

        .input-lettre {
            width: 50px;
            height: 50px;
            font-size: 24px;
            font-weight: bold;
            text-transform: uppercase;
            text-align: center;
            border: 2px solid #4CAF50;
            border-radius: 6px;
            padding: 0;
        }

        .input-lettre:focus {
            outline: none;
            border-color: #2E7D32;
            box-shadow: 0 0 5px rgba(76, 175, 80, 0.5);
        }

        .input-lettre:disabled {
            background-color: #D32F2F;
            color: white;
            border-color: #B71C1C;
        }

        @media (max-width: 768px) {
            .input-lettre {
                width: 40px;
                height: 40px;
                font-size: 20px;
            }
        }

        .filtre-position {
            width: 40px;
            height: 40px;
            font-size: 18px;
            font-weight: bold;
            text-transform: uppercase;
            text-align: center;
            border: 2px solid #ccc;
            border-radius: 6px;
            padding: 0;
        }

        .filtre-position:focus {
            outline: none;
            border-color: #4CAF50;
            box-shadow: 0 0 5px rgba(76, 175, 80, 0.3);
        }

        @media (max-width: 768px) {
            .filtre-position {
                width: 35px;
                height: 35px;
                font-size: 16px;
            }
        }

        .tentatives-jeu {
            margin-top: 20px;
        }

        /* Clavier AZERTY */
        .clavier-container {
            margin: 20px auto;
            max-width: 650px;
        }

        .clavier-row {
            display: flex;
            justify-content: center;
            gap: 4px;
            margin-bottom: 6px;
        }

        .touche-clavier {
            min-width: 40px;
            height: 50px;
            padding: 0 8px;
            font-size: 16px;
            font-weight: bold;
            text-transform: uppercase;
            border: 2px solid #999;
            border-radius: 6px;
            background-color: #666;
            color: white;
            cursor: pointer;
            transition: all 0.2s;
        }

        .touche-clavier:hover:not(:disabled) {
            background-color: #555;
            transform: translateY(-2px);
        }

        .touche-clavier:active:not(:disabled) {
            transform: translateY(0);
        }

        .touche-clavier:disabled {
            background-color: #5B8FDB;
            color: white;
            border-color: #4A7FCA;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .touche-clavier.bien-placee {
            background-color: #D32F2F;
            color: white;
            border-color: #B71C1C;
        }

        .touche-clavier.mal-placee {
            background-color: #C9B458;
            color: white;
            border-color: #B8A040;
        }

        .touche-clavier.absente {
            background-color: #5B8FDB;
            color: white;
            border-color: #4A7FCA;
            opacity: 0.8;
        }

        @media (max-width: 768px) {
            .touche-clavier {
                min-width: 30px;
                height: 40px;
                font-size: 14px;
                padding: 0 5px;
            }
        }

        /* Accord√©on */
        .accordion-header {
            background-color: #4CAF50;
            color: white;
            padding: 12px 15px;
            cursor: pointer;
            border: none;
            width: 100%;
            text-align: left;
            font-size: 16px;
            font-weight: bold;
            border-radius: 4px;
            transition: background-color 0.3s;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .accordion-header:hover {
            background-color: #45a049;
        }

        .accordion-header::after {
            content: '‚ñº';
            font-size: 12px;
            transition: transform 0.3s;
        }

        .accordion-header.active::after {
            transform: rotate(180deg);
        }

        .accordion-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
            padding: 0 15px;
        }

        .accordion-content.active {
            max-height: 200px;
            padding: 15px;
        }

        .tentative-row {
            display: flex;
            justify-content: center;
            gap: 5px;
            margin: 10px 0;
        }

        .ligne-tentative {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 5px;
            margin: 8px 0;
            padding: 8px;
            border-radius: 8px;
            transition: all 0.3s;
        }

        .ligne-tentative.active {
            background-color: #e8f5e9;
            padding: 10px;
            border: 2px solid #4CAF50;
            box-shadow: 0 0 10px rgba(76, 175, 80, 0.3);
        }

        .ligne-tentative.validee {
            opacity: 0.8;
        }

        .numero-essai {
            font-size: 16px;
            font-weight: bold;
            color: #4CAF50;
            width: 50px;
            flex-shrink: 0;
            text-align: center;
            margin-right: 5px;
        }

        .lettres-ligne {
            display: flex;
            gap: 5px;
            justify-content: flex-start;
        }

        .info-candidats {
            font-size: 12px;
            color: #666;
            min-width: 100px;
            text-align: right;
            margin-left: 10px;
        }

        @media (max-width: 768px) {
            .numero-essai {
                font-size: 14px;
                min-width: 30px;
            }

            .info-candidats {
                font-size: 11px;
                min-width: 70px;
            }
        }

        .tentative-groupe {
            display: flex;
            align-items: center;
            gap: 10px;
            margin: 10px 0;
            padding: 10px;
            background-color: #f9f9f9;
            border-radius: 8px;
            border-left: 4px solid #4CAF50;
        }

        .tentative-numero {
            font-size: 18px;
            font-weight: bold;
            color: #4CAF50;
            min-width: 30px;
            text-align: center;
        }

        .case-lettre {
            width: 50px;
            height: 50px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border: 2px solid #ddd;
            border-radius: 4px;
            font-size: 24px;
            font-weight: bold;
            background-color: white;
        }

        .case-lettre.remplie {
            border-color: #999;
        }

        .lettre-jeu {
            width: 50px;
            height: 50px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            font-weight: bold;
            border-radius: 6px;
            border: 2px solid #999;
        }

        @media (max-width: 768px) {
            .lettre-jeu {
                width: 40px;
                height: 40px;
                font-size: 20px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Sutom pour les marcheurs fatigu√©s <span style="font-size: 0.5em; color: #666; font-weight: normal;">v1.0</span></h1>

        <!-- Section commune de chargement du dictionnaire -->
        <div class="config-section" id="fichierDicoSection">
            <button class="accordion-header" onclick="toggleAccordion()">
                <span>Dictionnaire</span>
            </button>
            <div class="accordion-content" id="accordionContent">
                <div style="margin-top: 10px;">
                    <span style="color: #666; font-size: 14px; display: block; margin-bottom: 10px;" id="dicoStatus">Chargement du dictionnaire...</span>
                    <div class="form-group">
                        <label for="fichierDico">Charger un autre fichier:</label>
                        <input type="file" id="fichierDico" accept=".txt" onchange="chargerFichierDictionnaire()">
                    </div>
                </div>
            </div>
        </div>

        <!-- Onglets -->
        <div class="tabs">
            <button class="tab active" onclick="switchTab('aide')">Aide √† la r√©solution</button>
            <button class="tab" onclick="switchTab('jeu')">Jouer</button>
            <button class="tab" onclick="switchTab('dico')">Dictionnaire</button>
        </div>

        <!-- Onglet Aide -->
        <div id="aide-tab" class="tab-content active">
        <!-- Section Configuration -->
        <div class="config-section">
            <h2>Configuration</h2>
            <div class="form-group">
                <label for="premiereLettre">Premi√®re lettre:</label>
                <input type="text" id="premiereLettre" maxlength="1" style="width: 50px; text-transform: uppercase;">
            </div>
            <div class="form-group">
                <label for="nombreLettres">Nombre de lettres:</label>
                <input type="number" id="nombreLettres" min="3" max="15" value="6" style="width: 80px;">
            </div>
            <div class="form-group">
                <button onclick="demarrer()">D√©marrer</button>
            </div>
            <div id="configMessage"></div>
        </div>

        <!-- Section L√©gende -->
        <div class="legende-section">
            <h2>L√©gende</h2>
            <div class="legende-container">
                <div class="legende-item">
                    <div class="legende-box" style="background-color: #D32F2F;"></div>
                    <span>Bien plac√©e (=)</span>
                </div>
                <div class="legende-item">
                    <div class="legende-box" style="background-color: #C9B458;"></div>
                    <span>Mal plac√©e (?)</span>
                </div>
                <div class="legende-item">
                    <div class="legende-box" style="background-color: #5B8FDB;"></div>
                    <span>Absente (_)</span>
                </div>
            </div>
            <div class="legende-help">Cliquez sur chaque lettre pour changer son √©tat</div>
        </div>

        <!-- Section Grille de r√©solution -->
        <div class="proposition-section hidden" id="propositionSection">
            <h2>R√©solution</h2>
            <div class="info-text" id="infoText"></div>

            <!-- Grille des tentatives -->
            <div id="grilleResolution" style="margin: 20px auto; max-width: 600px;"></div>

            <div style="text-align: center; margin-top: 15px;">
                <button onclick="validerReponse()" id="validerBtn">Valider et continuer</button>
            </div>
        </div>
        </div>

        <!-- Onglet Jeu -->
        <div id="jeu-tab" class="tab-content">
            <div class="config-section">
                <h2>Configuration du jeu</h2>
                <div class="form-group">
                    <label for="nombreLettresJeu">Nombre de lettres:</label>
                    <input type="number" id="nombreLettresJeu" min="3" max="15" value="6" style="width: 80px;">
                </div>
                <div class="form-group">
                    <button onclick="demarrerJeu()">Nouvelle partie</button>
                </div>
                <div id="jeuMessage"></div>
            </div>

            <div class="proposition-section hidden" id="jeuSection">
                <h2>Tentez de deviner le mot</h2>
                <div class="info-text" id="jeuInfo"></div>

                <!-- Input invisible pour clavier mobile -->
                <input type="text" id="mobileInput" style="position: absolute; opacity: 0; pointer-events: none;" autocomplete="off" autocorrect="off" autocapitalize="characters">

                <!-- Grille des 6 tentatives -->
                <div id="grilleJeu" style="margin: 20px auto; max-width: 400px;"></div>

                <!-- Clavier AZERTY -->
                <div class="clavier-container" id="clavierJeu">
                    <div class="clavier-row">
                        <button class="touche-clavier" onclick="ajouterLettreJeu('A')">A</button>
                        <button class="touche-clavier" onclick="ajouterLettreJeu('Z')">Z</button>
                        <button class="touche-clavier" onclick="ajouterLettreJeu('E')">E</button>
                        <button class="touche-clavier" onclick="ajouterLettreJeu('R')">R</button>
                        <button class="touche-clavier" onclick="ajouterLettreJeu('T')">T</button>
                        <button class="touche-clavier" onclick="ajouterLettreJeu('Y')">Y</button>
                        <button class="touche-clavier" onclick="ajouterLettreJeu('U')">U</button>
                        <button class="touche-clavier" onclick="ajouterLettreJeu('I')">I</button>
                        <button class="touche-clavier" onclick="ajouterLettreJeu('O')">O</button>
                        <button class="touche-clavier" onclick="ajouterLettreJeu('P')">P</button>
                    </div>
                    <div class="clavier-row">
                        <button class="touche-clavier" onclick="ajouterLettreJeu('Q')">Q</button>
                        <button class="touche-clavier" onclick="ajouterLettreJeu('S')">S</button>
                        <button class="touche-clavier" onclick="ajouterLettreJeu('D')">D</button>
                        <button class="touche-clavier" onclick="ajouterLettreJeu('F')">F</button>
                        <button class="touche-clavier" onclick="ajouterLettreJeu('G')">G</button>
                        <button class="touche-clavier" onclick="ajouterLettreJeu('H')">H</button>
                        <button class="touche-clavier" onclick="ajouterLettreJeu('J')">J</button>
                        <button class="touche-clavier" onclick="ajouterLettreJeu('K')">K</button>
                        <button class="touche-clavier" onclick="ajouterLettreJeu('L')">L</button>
                        <button class="touche-clavier" onclick="ajouterLettreJeu('M')">M</button>
                    </div>
                    <div class="clavier-row">
                        <button class="touche-clavier" onclick="ajouterLettreJeu('W')">W</button>
                        <button class="touche-clavier" onclick="ajouterLettreJeu('X')">X</button>
                        <button class="touche-clavier" onclick="ajouterLettreJeu('C')">C</button>
                        <button class="touche-clavier" onclick="ajouterLettreJeu('V')">V</button>
                        <button class="touche-clavier" onclick="ajouterLettreJeu('B')">B</button>
                        <button class="touche-clavier" onclick="ajouterLettreJeu('N')">N</button>
                        <button class="touche-clavier" onclick="effacerLettreJeu()" style="min-width: 80px;">‚å´</button>
                    </div>
                </div>

                <!-- Bouton Valider -->
                <div style="text-align: center; margin: 20px 0;">
                    <button onclick="soumettreMotJeu()" style="padding: 12px 30px; font-size: 16px; font-weight: bold; background-color: #4CAF50; color: white; border: none; border-radius: 6px; cursor: pointer;">Valider</button>
                </div>
            </div>

            <div class="legende-section">
                <h2>L√©gende</h2>
                <div class="legende-container">
                    <div class="legende-item">
                        <div class="legende-box" style="background-color: #D32F2F;"></div>
                        <span>Bien plac√©e</span>
                    </div>
                    <div class="legende-item">
                        <div class="legende-box" style="background-color: #C9B458;"></div>
                        <span>Mal plac√©e</span>
                    </div>
                    <div class="legende-item">
                        <div class="legende-box" style="background-color: #5B8FDB;"></div>
                        <span>Absente</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Onglet Dictionnaire -->
        <div id="dico-tab" class="tab-content">
            <div class="config-section">
                <h2>Configuration</h2>
                <div class="form-group">
                    <label for="longueurDico">Longueur des mots:</label>
                    <input type="number" id="longueurDico" min="3" max="15" value="6" style="width: 80px; padding: 8px; border: 1px solid #ccc; border-radius: 4px;">
                </div>
                <div class="form-group">
                    <button id="btnInitDico" onclick="toggleFiltreDico()">Initialiser</button>
                </div>
            </div>

            <!-- Section L√©gende -->
            <div class="legende-section">
                <h2>L√©gende</h2>
                <div class="legende-container">
                    <div class="legende-item">
                        <div class="legende-box" style="background-color: #D32F2F;"></div>
                        <span>Bien plac√©e</span>
                    </div>
                    <div class="legende-item">
                        <div class="legende-box" style="background-color: #C9B458;"></div>
                        <span>Mal plac√©e (dans le mot)</span>
                    </div>
                    <div class="legende-item">
                        <div class="legende-box" style="background-color: #5B8FDB;"></div>
                        <span>Absente</span>
                    </div>
                    <div class="legende-item">
                        <div class="legende-box" style="background-color: #e0e0e0;"></div>
                        <span>Non d√©finie</span>
                    </div>
                </div>
                <div class="legende-help">
                    <strong>Interactions :</strong><br>
                    ‚Ä¢ Simple clic : cycler les √©tats (blanc ‚Üí rouge ‚Üí jaune ‚Üí bleu ‚Üí blanc)<br>
                    ‚Ä¢ Double-clic : √©diter la lettre
                </div>
            </div>

            <!-- Section Filtres par contraintes -->
            <div class="config-section hidden" id="filtresDicoSection">
                <h2>Contraintes sur les lettres</h2>
                <p style="font-size: 14px; color: #666; margin-bottom: 15px;">
                    Saisissez vos lettres, puis utilisez le simple clic pour cycler les √©tats ou le double-clic pour modifier une lettre.
                    Le bouton ‚ûï ajoute une nouvelle ligne de contraintes.
                </p>

                <!-- Grille des contraintes -->
                <div id="grilleContraintes" style="margin: 20px auto; max-width: 600px;"></div>
            </div>

            <div class="config-section">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                    <h2 style="margin: 0;">Mots du dictionnaire</h2>
                    <div style="font-weight: bold; color: #4CAF50;" id="compteurMots"></div>
                </div>
                <textarea id="affichageDico"
                          readonly
                          style="width: 100%; height: 400px; font-family: monospace; font-size: 14px; padding: 10px; border: 1px solid #ccc; border-radius: 4px; resize: vertical;">
                </textarea>
            </div>
        </div>
    </div>

    <!-- Menu contextuel -->
    <div id="contextMenu" class="context-menu hidden">
        <div class="context-menu-item" onclick="setEtat(currentLettreIndex, '=')">‚úì Bien plac√©e (=)</div>
        <div class="context-menu-item" onclick="setEtat(currentLettreIndex, '?')">? Mal plac√©e (?)</div>
        <div class="context-menu-item" onclick="setEtat(currentLettreIndex, '_')">‚úó Absente (_)</div>
    </div>

    <script>
        // Variables globales pour l'aide
        let dictionnaire = [];
        let candidats = [];
        let essai = 0;
        let motActuel = '';
        let reponseActuelle = [];
        let currentLettreIndex = -1;
        let lettresConnues = {}; // Pour m√©moriser les lettres bien plac√©es
        let historiqueTentatives = []; // Historique des tentatives valid√©es

        // Variables globales pour le jeu
        let motSecret = '';
        let tentativesJeu = 0;
        let maxTentatives = 6;
        let partieTerminee = false;

        // Variables globales pour le dictionnaire
        let longueurDicoSelectionnee = 0;
        let longueurMaxDico = 0;
        let contraintesDico = []; // Liste des contraintes: {lettres: ['A', '', 'B', ...], etats: ['=', '', '?', ...]}

        // Gestion des onglets
        function switchTab(tabName) {
            // Masquer tous les contenus
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // D√©sactiver tous les onglets
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Activer l'onglet s√©lectionn√©
            if (tabName === 'aide') {
                document.getElementById('aide-tab').classList.add('active');
                document.querySelectorAll('.tab')[0].classList.add('active');
            } else if (tabName === 'jeu') {
                document.getElementById('jeu-tab').classList.add('active');
                document.querySelectorAll('.tab')[1].classList.add('active');
            } else if (tabName === 'dico') {
                document.getElementById('dico-tab').classList.add('active');
                document.querySelectorAll('.tab')[2].classList.add('active');
                afficherDictionnaire();
            }
        }

        // Gestion de l'accord√©on
        function toggleAccordion() {
            const header = document.querySelector('.accordion-header');
            const content = document.getElementById('accordionContent');
            
            header.classList.toggle('active');
            content.classList.toggle('active');
        }

        // Essayer de charger le dictionnaire par d√©faut au d√©marrage
        window.addEventListener('DOMContentLoaded', function() {
            fetch('dico.txt')
                .then(response => {
                    if (!response.ok) {
                        throw new Error('Fichier non trouv√©');
                    }
                    return response.text();
                })
                .then(data => {
                    dictionnaire = data.split('\n')
                        .map(mot => mot.trim().toUpperCase())
                        .filter(mot => mot.length > 0);
                    calculerLongueurMaxDico();
                    afficherDictionnaire();
                    document.getElementById('dicoStatus').textContent = `‚úì Dictionnaire charg√©: ${dictionnaire.length} mots`;
                    document.getElementById('dicoStatus').style.color = '#2e7d32';
                    console.log(`Dictionnaire par d√©faut charg√©: ${dictionnaire.length} mots`);
                })
                .catch(error => {
                    document.getElementById('dicoStatus').textContent = 'Veuillez charger un fichier dictionnaire';
                    document.getElementById('dicoStatus').style.color = '#c62828';
                    console.log('Pas de dictionnaire par d√©faut, utilisateur devra en charger un');
                });
        });

        // Charger le fichier dictionnaire s√©lectionn√©
        function chargerFichierDictionnaire() {
            const fileInput = document.getElementById('fichierDico');
            const file = fileInput.files[0];
            
            if (!file) {
                return;
            }

            const reader = new FileReader();
            reader.onload = function(e) {
                const content = e.target.result;
                dictionnaire = content.split('\n')
                    .map(mot => mot.trim().toUpperCase())
                    .filter(mot => mot.length > 0);
                calculerLongueurMaxDico();
                afficherDictionnaire();
                document.getElementById('dicoStatus').textContent = `‚úì Dictionnaire charg√©: ${dictionnaire.length} mots`;
                document.getElementById('dicoStatus').style.color = '#2e7d32';
                console.log(`Dictionnaire charg√©: ${dictionnaire.length} mots`);
            };
            reader.onerror = function() {
                document.getElementById('dicoStatus').textContent = 'Erreur lors de la lecture du fichier';
                document.getElementById('dicoStatus').style.color = '#c62828';
            };
            reader.readAsText(file, 'UTF-8');
        }

        // Charger dictionnaire selon crit√®res
        function chargerDictionnaire(premiereLettre, longueur) {
            return dictionnaire.filter(mot => 
                mot.length === longueur && mot[0] === premiereLettre
            );
        }

        // G√©n√©rer le pattern de r√©ponse
        function genererPattern(motTest, motSolution) {
            let pattern = Array(motTest.length).fill('_');
            let lettresSolution = motSolution.split('');

            // D'abord les bien plac√©es
            for (let i = 0; i < motTest.length; i++) {
                if (motTest[i] === motSolution[i]) {
                    pattern[i] = '=';
                    lettresSolution[i] = null;
                }
            }

            // Puis les mal plac√©es
            for (let i = 0; i < motTest.length; i++) {
                if (pattern[i] === '_' && lettresSolution.includes(motTest[i])) {
                    pattern[i] = '?';
                    lettresSolution[lettresSolution.indexOf(motTest[i])] = null;
                }
            }

            return pattern.join('');
        }

        // Calculer l'entropie
        function calculerEntropie(motTest, candidats) {
            let partitions = {};
            
            candidats.forEach(candidat => {
                let pattern = genererPattern(motTest, candidat);
                if (!partitions[pattern]) {
                    partitions[pattern] = [];
                }
                partitions[pattern].push(candidat);
            });

            let entropie = 0;
            let n = candidats.length;

            Object.values(partitions).forEach(groupe => {
                let p = groupe.length / n;
                if (p > 0) {
                    entropie -= p * Math.log2(p);
                }
            });

            return entropie;
        }

        // Trouver le meilleur mot
        function meilleurMot(candidats) {
            if (candidats.length === 1) {
                return candidats[0];
            }

            let meilleur = null;
            let maxEntropie = -1;

            candidats.forEach(mot => {
                let entropie = calculerEntropie(mot, candidats);
                if (entropie > maxEntropie) {
                    maxEntropie = entropie;
                    meilleur = mot;
                }
            });

            return meilleur;
        }

        // Filtrer les candidats
        function filtrerCandidats(candidats, motTest, reponse) {
            return candidats.filter(candidat => 
                genererPattern(motTest, candidat) === reponse
            );
        }

        // D√©marrer une nouvelle partie
        function demarrer() {
            if (dictionnaire.length === 0) {
                showMessage('configMessage', 'Veuillez d\'abord charger un fichier dictionnaire ou attendre le chargement du dictionnaire par d√©faut', 'error');
                return;
            }

            let premiereLettre = document.getElementById('premiereLettre').value.trim().toUpperCase();
            let nombreLettres = parseInt(document.getElementById('nombreLettres').value);

            if (!premiereLettre || premiereLettre.length !== 1) {
                showMessage('configMessage', 'Veuillez entrer une seule lettre', 'error');
                return;
            }

            if (!nombreLettres || nombreLettres < 3 || nombreLettres > 15) {
                showMessage('configMessage', 'Veuillez entrer un nombre de lettres valide (3-15)', 'error');
                return;
            }

            candidats = chargerDictionnaire(premiereLettre, nombreLettres);

            if (candidats.length === 0) {
                showMessage('configMessage', 'Aucun mot trouv√© avec ces crit√®res', 'error');
                return;
            }

            showMessage('configMessage', `${candidats.length} mots possibles trouv√©s`, 'success');

            // R√©initialiser
            essai = 0;
            lettresConnues = {}; // R√©initialiser les lettres connues
            historiqueTentatives = []; // R√©initialiser l'historique
            document.getElementById('propositionSection').classList.remove('hidden');

            proposerMot();
        }

        // Proposer un nouveau mot
        function proposerMot() {
            if (candidats.length === 0) {
                showMessage('configMessage', 'Aucun mot ne correspond aux r√©ponses donn√©es', 'info');
                return;
            }

            essai++;
            motActuel = meilleurMot(candidats);
            reponseActuelle = Array(motActuel.length).fill('_');

            // La premi√®re lettre est toujours bien plac√©e (connue d√®s le d√©part)
            reponseActuelle[0] = '=';

            // Pr√©-remplir avec les autres lettres connues
            for (let pos in lettresConnues) {
                let index = parseInt(pos);
                if (motActuel[index] === lettresConnues[pos]) {
                    reponseActuelle[index] = '=';
                }
            }

            document.getElementById('infoText').textContent =
                `Essai ${essai} - ${candidats.length} candidat(s) restant(s)`;

            // Reconstruire toute la grille
            afficherGrilleResolution();
        }

        // Afficher la grille compl√®te avec historique + ligne active
        function afficherGrilleResolution() {
            let grille = document.getElementById('grilleResolution');
            grille.innerHTML = '';

            // Afficher l'historique des tentatives valid√©es
            historiqueTentatives.forEach((tentative, index) => {
                let ligneDiv = creerLigneTentative(
                    tentative.essai,
                    tentative.mot,
                    tentative.reponse,
                    tentative.candidatsRestants,
                    false // pas active
                );
                ligneDiv.classList.add('validee');
                grille.appendChild(ligneDiv);
            });

            // Afficher la ligne active (proposition actuelle)
            let ligneActive = creerLigneTentative(
                essai,
                motActuel,
                reponseActuelle,
                candidats.length,
                true // active
            );
            ligneActive.classList.add('active');
            grille.appendChild(ligneActive);
        }

        // Cr√©er une ligne de tentative
        function creerLigneTentative(numEssai, mot, reponse, nbCandidats, estActive) {
            let ligneDiv = document.createElement('div');
            ligneDiv.className = 'ligne-tentative';

            // Num√©ro de l'essai
            let numeroDiv = document.createElement('div');
            numeroDiv.className = 'numero-essai';
            numeroDiv.textContent = `#${numEssai}`;
            ligneDiv.appendChild(numeroDiv);

            // Conteneur des lettres
            let lettresDiv = document.createElement('div');
            lettresDiv.className = 'lettres-ligne';

            for (let i = 0; i < mot.length; i++) {
                let btn = document.createElement('button');
                btn.className = 'lettre-btn';
                btn.textContent = mot[i];

                // Appliquer la couleur selon la r√©ponse
                if (reponse[i] === '=') {
                    btn.classList.add('bien-placee');
                } else if (reponse[i] === '?') {
                    btn.classList.add('mal-placee');
                } else if (reponse[i] === '_') {
                    btn.classList.add('absente');
                }

                // Si c'est la ligne active, permettre l'interaction
                if (estActive) {
                    btn.onclick = () => cycleEtat(i);
                    btn.oncontextmenu = (e) => {
                        e.preventDefault();
                        afficherMenu(e, i);
                    };
                }

                lettresDiv.appendChild(btn);
            }
            ligneDiv.appendChild(lettresDiv);

            // Info candidats restants
            let infoDiv = document.createElement('div');
            infoDiv.className = 'info-candidats';
            infoDiv.textContent = `${nbCandidats} mot${nbCandidats > 1 ? 's' : ''}`;
            ligneDiv.appendChild(infoDiv);

            return ligneDiv;
        }

        // Changer l'√©tat d'une lettre (cycle)
        function cycleEtat(index) {
            // La premi√®re lettre ne peut pas √™tre modifi√©e (toujours bien plac√©e)
            if (index === 0) {
                return;
            }
            
            let etats = ['_', '?', '='];
            let etatActuel = reponseActuelle[index];
            let nouvelEtat = etats[(etats.indexOf(etatActuel) + 1) % 3];
            setEtat(index, nouvelEtat);
        }

        // D√©finir l'√©tat d'une lettre
        function setEtat(index, etat) {
            // La premi√®re lettre ne peut pas √™tre modifi√©e (toujours bien plac√©e)
            if (index === 0) {
                return;
            }
            
            reponseActuelle[index] = etat;

            // Rafra√Æchir l'affichage de la grille
            afficherGrilleResolution();

            document.getElementById('contextMenu').classList.add('hidden');
        }

        // Afficher le menu contextuel
        function afficherMenu(event, index) {
            currentLettreIndex = index;
            let menu = document.getElementById('contextMenu');
            menu.style.left = event.pageX + 'px';
            menu.style.top = event.pageY + 'px';
            menu.classList.remove('hidden');
        }

        // Cacher le menu contextuel au clic ailleurs
        document.addEventListener('click', () => {
            document.getElementById('contextMenu').classList.add('hidden');
        });

        // Valider la r√©ponse
        function validerReponse() {
            let reponse = reponseActuelle.join('');

            // M√©moriser les lettres bien plac√©es
            for (let i = 0; i < motActuel.length; i++) {
                if (reponseActuelle[i] === '=') {
                    lettresConnues[i] = motActuel[i];
                }
            }

            // Ajouter √† l'historique
            historiqueTentatives.push({
                essai: essai,
                mot: motActuel,
                reponse: [...reponseActuelle],
                candidatsRestants: candidats.length
            });

            // V√©rifier si gagn√©
            if (reponse === '='.repeat(motActuel.length)) {
                showMessage('configMessage', `üéâ Mot trouv√© en ${essai} essai(s): ${motActuel}`, 'success');
                // Afficher la grille finale sans ligne active
                afficherGrilleFinale();
                return;
            }

            // Filtrer les candidats
            candidats = filtrerCandidats(candidats, motActuel, reponse);

            if (candidats.length === 0) {
                showMessage('configMessage', 'Aucun mot ne correspond. V√©rifiez vos r√©ponses.', 'error');
                afficherGrilleFinale();
                return;
            }

            // Proposer le mot suivant
            proposerMot();
        }

        // Afficher la grille finale (sans ligne active)
        function afficherGrilleFinale() {
            let grille = document.getElementById('grilleResolution');
            grille.innerHTML = '';

            historiqueTentatives.forEach((tentative) => {
                let ligneDiv = creerLigneTentative(
                    tentative.essai,
                    tentative.mot,
                    tentative.reponse,
                    tentative.candidatsRestants,
                    false
                );
                ligneDiv.classList.add('validee');
                grille.appendChild(ligneDiv);
            });
        }

        // Afficher un message
        function showMessage(elementId, message, type) {
            let element = document.getElementById(elementId);
            element.innerHTML = `<div class="message ${type}">${message}</div>`;
        }

        // ===== FONCTIONS POUR LE MODE JEU =====

        // D√©marrer une nouvelle partie
        function demarrerJeu() {
            if (dictionnaire.length === 0) {
                showMessage('jeuMessage', 'Veuillez d\'abord charger un dictionnaire ou attendre son chargement', 'error');
                return;
            }

            let longueur = parseInt(document.getElementById('nombreLettresJeu').value);
            if (!longueur || longueur < 3 || longueur > 15) {
                showMessage('jeuMessage', 'Veuillez entrer un nombre de lettres valide (3-15)', 'error');
                return;
            }

            // Filtrer les mots de la bonne longueur
            let motsDisponibles = dictionnaire.filter(mot => mot.length === longueur);
            
            if (motsDisponibles.length === 0) {
                showMessage('jeuMessage', 'Aucun mot de cette longueur dans le dictionnaire', 'error');
                return;
            }

            // Choisir un mot au hasard
            motSecret = motsDisponibles[Math.floor(Math.random() * motsDisponibles.length)];
            tentativesJeu = 0;
            partieTerminee = false;

            // R√©initialiser l'interface
            document.getElementById('jeuSection').classList.remove('hidden');
            
            // R√©initialiser le clavier
            reinitialiserClavier();
            
            // Cr√©er la grille de 6 lignes
            creerGrilleJeu(longueur);

            updateJeuInfo();
            showMessage('jeuMessage', `Partie d√©marr√©e ! Trouvez le mot de ${longueur} lettres commen√ßant par ${motSecret[0]}`, 'success');

            // Donner le focus √† l'input mobile pour d√©clencher le clavier virtuel
            setTimeout(() => {
                let mobileInput = document.getElementById('mobileInput');
                if (mobileInput) {
                    mobileInput.focus();
                }
            }, 100);

            console.log('Mot secret:', motSecret); // Pour debug
        }

        // Cr√©er la grille de jeu - n'afficher que les lignes jusqu'√† la tentative actuelle
        function creerGrilleJeu(longueur) {
            let grille = document.getElementById('grilleJeu');
            grille.innerHTML = '';

            // Afficher seulement les lignes pr√©c√©dentes + la ligne active
            let nbLignesAfficher = tentativesJeu + 1;

            for (let ligne = 0; ligne < nbLignesAfficher; ligne++) {
                let ligneDiv = document.createElement('div');
                ligneDiv.className = 'ligne-tentative';
                ligneDiv.id = `ligne-${ligne}`;
                if (ligne === tentativesJeu) {
                    ligneDiv.classList.add('active');
                }

                for (let i = 0; i < longueur; i++) {
                    let caseDiv = document.createElement('div');
                    caseDiv.className = 'case-lettre';
                    caseDiv.id = `case-${ligne}-${i}`;

                    // Premi√®re lettre de chaque ligne pr√©-remplie
                    if (i === 0) {
                        caseDiv.textContent = motSecret[0];
                        caseDiv.classList.add('remplie');
                        caseDiv.style.backgroundColor = '#D32F2F';
                        caseDiv.style.color = 'white';
                        caseDiv.style.borderColor = '#B71C1C';
                    }

                    ligneDiv.appendChild(caseDiv);
                }

                grille.appendChild(ligneDiv);
            }

            // Ajouter le gestionnaire d'√©v√©nements pour le clavier physique
            ajouterEcouteurClavierJeu();
        }

        // Ajouter l'√©couteur du clavier physique
        function ajouterEcouteurClavierJeu() {
            // Retirer l'ancien √©couteur s'il existe
            document.removeEventListener('keydown', gererToucheClavierJeu);
            // Ajouter le nouvel √©couteur
            document.addEventListener('keydown', gererToucheClavierJeu);

            // Ajouter l'√©couteur pour l'input mobile
            let mobileInput = document.getElementById('mobileInput');
            if (mobileInput) {
                mobileInput.addEventListener('input', gererInputMobile);
                mobileInput.addEventListener('keydown', gererToucheMobile);
            }
        }

        // G√©rer l'input mobile
        function gererInputMobile(e) {
            let input = e.target;
            let valeur = input.value.toUpperCase();

            if (valeur && valeur.length > 0) {
                let dernierCaractere = valeur[valeur.length - 1];
                if (dernierCaractere >= 'A' && dernierCaractere <= 'Z') {
                    ajouterLettreJeu(dernierCaractere);
                }
            }

            // Vider l'input pour permettre la saisie suivante
            input.value = '';
        }

        // G√©rer les touches sp√©ciales sur mobile
        function gererToucheMobile(e) {
            if (partieTerminee) {
                return;
            }

            if (e.key === 'Backspace' || e.key === 'Delete') {
                e.preventDefault();
                effacerLettreJeu();
            } else if (e.key === 'Enter') {
                e.preventDefault();
                soumettreMotJeu();
            }
        }

        // G√©rer les touches du clavier physique
        function gererToucheClavierJeu(e) {
            // Ne rien faire si la partie est termin√©e ou si on n'est pas dans l'onglet jeu
            if (partieTerminee || !document.getElementById('jeu-tab').classList.contains('active')) {
                return;
            }

            // Ignorer si on est dans un champ de saisie (sauf l'input mobile qui est g√©r√© s√©par√©ment)
            if ((e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA') && e.target.id !== 'mobileInput') {
                return;
            }

            // Si c'est l'input mobile, ne rien faire ici (g√©r√© par gererInputMobile)
            if (e.target.id === 'mobileInput') {
                return;
            }

            const key = e.key.toUpperCase();

            // Lettres A-Z
            if (key.length === 1 && key >= 'A' && key <= 'Z') {
                e.preventDefault();
                ajouterLettreJeu(key);
            }
            // Backspace ou Delete
            else if (e.key === 'Backspace' || e.key === 'Delete') {
                e.preventDefault();
                effacerLettreJeu();
            }
            // Enter
            else if (e.key === 'Enter') {
                e.preventDefault();
                soumettreMotJeu();
            }
        }

        // Mettre √† jour les infos du jeu
        function updateJeuInfo() {
            document.getElementById('jeuInfo').textContent = 
                `Tentative ${tentativesJeu + 1}/${maxTentatives} - Mot de ${motSecret.length} lettres commen√ßant par ${motSecret[0]}`;
        }

        // Soumettre un mot
        function soumettreMotJeu() {
            if (partieTerminee) {
                return;
            }

            // R√©cup√©rer le mot depuis la ligne active
            let motPropose = '';
            for (let i = 0; i < motSecret.length; i++) {
                let caseDiv = document.getElementById(`case-${tentativesJeu}-${i}`);
                motPropose += (caseDiv.textContent || '').toUpperCase();
            }
            
            // Validations
            if (motPropose.length !== motSecret.length) {
                showMessage('jeuMessage', `Le mot doit contenir exactement ${motSecret.length} lettres`, 'error');
                refocusMobileInput();
                return;
            }

            if (motPropose[0] !== motSecret[0]) {
                showMessage('jeuMessage', `Le mot doit commencer par ${motSecret[0]}`, 'error');
                refocusMobileInput();
                return;
            }

            if (!dictionnaire.includes(motPropose)) {
                showMessage('jeuMessage', 'Ce mot n\'est pas dans le dictionnaire', 'error');
                refocusMobileInput();
                return;
            }

            // Colorer la ligne avec les r√©sultats
            colorerLigne(tentativesJeu, motPropose);
            
            // Mettre √† jour l'√©tat du clavier
            let pattern = genererPattern(motPropose, motSecret);
            mettreAJourClavier(motPropose, pattern);
            
            // V√©rifier si gagn√©
            if (motPropose === motSecret) {
                partieTerminee = true;
                showMessage('jeuMessage', `üéâ Bravo ! Vous avez trouv√© le mot "${motSecret}" en ${tentativesJeu + 1} tentative(s) !`, 'success');
                return;
            }

            // Incr√©menter tentatives
            tentativesJeu++;

            // V√©rifier si perdu
            if (tentativesJeu >= maxTentatives) {
                partieTerminee = true;
                showMessage('jeuMessage', `üòû Perdu ! Le mot √©tait "${motSecret}"`, 'error');
                return;
            }

            // D√©sactiver la ligne pr√©c√©dente
            document.getElementById(`ligne-${tentativesJeu - 1}`).classList.remove('active');

            // Cr√©er et ajouter la nouvelle ligne
            ajouterNouvelleLigneJeu();

            updateJeuInfo();
            showMessage('jeuMessage', '', 'info');

            // Remettre le focus sur l'input mobile pour continuer √† jouer
            refocusMobileInput();
        }

        // Ajouter une nouvelle ligne de jeu
        function ajouterNouvelleLigneJeu() {
            let grille = document.getElementById('grilleJeu');
            let ligneDiv = document.createElement('div');
            ligneDiv.className = 'ligne-tentative active';
            ligneDiv.id = `ligne-${tentativesJeu}`;

            for (let i = 0; i < motSecret.length; i++) {
                let caseDiv = document.createElement('div');
                caseDiv.className = 'case-lettre';
                caseDiv.id = `case-${tentativesJeu}-${i}`;

                // Premi√®re lettre pr√©-remplie
                if (i === 0) {
                    caseDiv.textContent = motSecret[0];
                    caseDiv.classList.add('remplie');
                    caseDiv.style.backgroundColor = '#D32F2F';
                    caseDiv.style.color = 'white';
                    caseDiv.style.borderColor = '#B71C1C';
                }

                ligneDiv.appendChild(caseDiv);
            }

            grille.appendChild(ligneDiv);
        }

        // Colorer une ligne selon le pattern
        function colorerLigne(numLigne, motPropose) {
            let pattern = genererPattern(motPropose, motSecret);
            
            for (let i = 0; i < motPropose.length; i++) {
                let caseDiv = document.getElementById(`case-${numLigne}-${i}`);
                
                if (pattern[i] === '=') {
                    caseDiv.style.backgroundColor = '#D32F2F';
                    caseDiv.style.color = 'white';
                    caseDiv.style.borderColor = '#B71C1C';
                } else if (pattern[i] === '?') {
                    caseDiv.style.backgroundColor = '#C9B458';
                    caseDiv.style.color = 'white';
                    caseDiv.style.borderColor = '#B8A040';
                } else {
                    caseDiv.style.backgroundColor = '#5B8FDB';
                    caseDiv.style.color = 'white';
                    caseDiv.style.borderColor = '#4A7FCA';
                }
            }
        }

        // Vider les champs de lettres (obsol√®te mais gard√©e pour compatibilit√©)
        function viderChampsLettres() {
            // Ne fait plus rien - gard√©e pour compatibilit√©
        }

        // D√©sactiver les champs de lettres (obsol√®te mais gard√©e pour compatibilit√©)
        function desactiverChampsLettres() {
            // Ne fait plus rien - gard√©e pour compatibilit√©
        }

        // Fonction pour ajouter une lettre depuis le clavier
        function ajouterLettreJeu(lettre) {
            if (partieTerminee) {
                return;
            }

            // Trouver la premi√®re case vide de la ligne active (en sautant la premi√®re qui est pr√©-remplie)
            for (let i = 1; i < motSecret.length; i++) {
                let caseDiv = document.getElementById(`case-${tentativesJeu}-${i}`);
                if (!caseDiv.textContent || caseDiv.textContent === '') {
                    caseDiv.textContent = lettre;
                    caseDiv.classList.add('remplie');

                    // Remettre le focus sur l'input mobile
                    refocusMobileInput();
                    return;
                }
            }

            // Remettre le focus m√™me si toutes les cases sont remplies
            refocusMobileInput();
        }

        // Fonction pour remettre le focus sur l'input mobile
        function refocusMobileInput() {
            let mobileInput = document.getElementById('mobileInput');
            if (mobileInput) {
                setTimeout(() => mobileInput.focus(), 10);
            }
        }

        // Fonction pour effacer la derni√®re lettre saisie
        function effacerLettreJeu() {
            if (partieTerminee) {
                return;
            }

            // Trouver la derni√®re case remplie de la ligne active (en partant de la fin, sauf la premi√®re)
            for (let i = motSecret.length - 1; i >= 1; i--) {
                let caseDiv = document.getElementById(`case-${tentativesJeu}-${i}`);
                if (caseDiv.textContent && caseDiv.textContent !== '') {
                    caseDiv.textContent = '';
                    caseDiv.classList.remove('remplie');

                    // Remettre le focus sur l'input mobile
                    refocusMobileInput();
                    return;
                }
            }

            // Remettre le focus m√™me si rien n'a √©t√© effac√©
            refocusMobileInput();
        }

        // Fonction pour mettre √† jour l'√©tat des touches du clavier
        function mettreAJourClavier(motPropose, pattern) {
            for (let i = 0; i < motPropose.length; i++) {
                let lettre = motPropose[i];
                let bouton = document.querySelector(`.touche-clavier[onclick="ajouterLettreJeu('${lettre}')"]`);

                if (bouton) {
                    if (pattern[i] === '=') {
                        // Bien plac√©e - rouge (priorit√© la plus haute)
                        bouton.classList.remove('mal-placee', 'absente');
                        bouton.classList.add('bien-placee');
                    } else if (pattern[i] === '?' && !bouton.classList.contains('bien-placee')) {
                        // Mal plac√©e - jaune (seulement si pas d√©j√† bien plac√©e)
                        bouton.classList.add('mal-placee');
                    } else if (pattern[i] === '_' && !bouton.classList.contains('bien-placee') && !bouton.classList.contains('mal-placee')) {
                        // Absente - marquer visuellement mais garder activ√©
                        bouton.classList.add('absente');
                    }
                }
            }
        }

        // Fonction pour r√©initialiser le clavier
        function reinitialiserClavier() {
            document.querySelectorAll('.touche-clavier').forEach(bouton => {
                bouton.disabled = false;
                bouton.classList.remove('bien-placee', 'mal-placee', 'absente');
            });
        }

        // Fonction pour calculer la longueur maximale des mots du dictionnaire
        function calculerLongueurMaxDico() {
            if (dictionnaire.length === 0) {
                longueurMaxDico = 15; // Valeur par d√©faut
                return;
            }
            // Utiliser une boucle pour √©viter le d√©passement de pile avec spread operator
            longueurMaxDico = 0;
            for (let mot of dictionnaire) {
                if (mot.length > longueurMaxDico) {
                    longueurMaxDico = mot.length;
                }
            }
            document.getElementById('longueurDico').max = longueurMaxDico;
            console.log(`Longueur maximale du dictionnaire: ${longueurMaxDico}`);
        }

        // Initialiser le filtre du dictionnaire
        function toggleFiltreDico() {
            // Si les filtres sont actifs, r√©initialiser
            if (longueurDicoSelectionnee > 0) {
                reinitialiserFiltreDico();
            } else {
                initialiserFiltreDico();
            }
        }

        function initialiserFiltreDico() {
            let longueur = parseInt(document.getElementById('longueurDico').value);

            if (!longueur || longueur < 3 || longueur > 15) {
                alert('Veuillez entrer une longueur valide (3-15)');
                return;
            }

            longueurDicoSelectionnee = longueur;
            contraintesDico = [];

            // Cr√©er automatiquement la premi√®re ligne de contrainte
            contraintesDico.push({
                lettres: new Array(longueurDicoSelectionnee).fill(''),
                etats: new Array(longueurDicoSelectionnee).fill('')
            });

            document.getElementById('filtresDicoSection').classList.remove('hidden');
            document.getElementById('btnInitDico').textContent = 'R√©initialiser';
            afficherGrilleContraintes();
            filtrerDictionnaire();
        }

        // Afficher la grille des contraintes
        function afficherGrilleContraintes() {
            let grille = document.getElementById('grilleContraintes');
            grille.innerHTML = '';

            contraintesDico.forEach((contrainte, index) => {
                let ligneDiv = creerLigneContrainte(index, contrainte);
                grille.appendChild(ligneDiv);
            });
        }

        // Cr√©er une ligne de contrainte
        function creerLigneContrainte(index, contrainte) {
            let ligneDiv = document.createElement('div');
            ligneDiv.className = 'ligne-tentative';
            ligneDiv.style.marginBottom = '10px';

            // Num√©ro de la contrainte
            let numeroDiv = document.createElement('div');
            numeroDiv.className = 'numero-essai';
            numeroDiv.textContent = `#${index + 1}`;
            ligneDiv.appendChild(numeroDiv);

            // Conteneur des lettres
            let lettresDiv = document.createElement('div');
            lettresDiv.className = 'lettres-ligne';

            for (let i = 0; i < longueurDicoSelectionnee; i++) {
                let btn = document.createElement('button');
                btn.className = 'lettre-btn';
                btn.dataset.ligneIndex = index;
                btn.dataset.caseIndex = i;

                // Afficher la lettre ou un espace vide
                if (contrainte.lettres[i]) {
                    btn.textContent = contrainte.lettres[i];
                }

                // Appliquer la couleur selon l'√©tat
                if (contrainte.etats[i] === '=') {
                    btn.classList.add('bien-placee');
                } else if (contrainte.etats[i] === '?') {
                    btn.classList.add('mal-placee');
                } else if (contrainte.etats[i] === '_') {
                    btn.classList.add('absente');
                }

                // G√©rer les clicks (cycler les couleurs)
                btn.addEventListener('click', (e) => {
                    cyclerCouleurContrainte(index, i, e);
                });

                // G√©rer les double-clicks (√©diter la lettre)
                btn.addEventListener('dblclick', (e) => {
                    e.preventDefault();
                    cyclerCaseContrainte(index, i, e);
                });

                lettresDiv.appendChild(btn);
            }
            ligneDiv.appendChild(lettresDiv);

            // Conteneur des boutons d'action avec largeur fixe pour l'alignement
            let actionsDiv = document.createElement('div');
            actionsDiv.style.cssText = 'display: flex; gap: 5px; margin-left: 10px; width: 100px; flex-shrink: 0;';

            // Bouton ajouter (seulement sur la derni√®re ligne)
            if (index === contraintesDico.length - 1) {
                let btnAjouter = document.createElement('button');
                btnAjouter.innerHTML = '&#xff0b;'; // Full-width plus sign
                btnAjouter.title = 'Ajouter une ligne';
                btnAjouter.style.cssText = 'background-color: #4CAF50; color: white; padding: 8px 12px; border: none; border-radius: 4px; cursor: pointer; width: 45px; font-size: 20px; font-weight: bold;';
                btnAjouter.onclick = () => ajouterLigneContrainte();
                actionsDiv.appendChild(btnAjouter);
            }

            // Bouton supprimer (seulement s'il y a plus d'une ligne)
            if (contraintesDico.length > 1) {
                let btnSupprimer = document.createElement('button');
                btnSupprimer.innerHTML = '&#x1f5d1;'; // Wastebasket icon
                btnSupprimer.title = 'Supprimer cette ligne';
                btnSupprimer.style.cssText = 'background-color: #f44336; color: white; padding: 8px 12px; border: none; border-radius: 4px; cursor: pointer; width: 45px; font-size: 16px;';
                btnSupprimer.onclick = () => supprimerContrainte(index);
                actionsDiv.appendChild(btnSupprimer);
            }

            ligneDiv.appendChild(actionsDiv);

            return ligneDiv;
        }

        // Variable pour suivre la case en cours d'√©dition
        let caseEnEdition = null;

        // √âditer une case de contrainte (double-clic)
        function cyclerCaseContrainte(indexLigne, indexCase, event) {
            // Si une autre case est en √©dition, la finaliser d'abord
            if (caseEnEdition && (caseEnEdition.indexLigne !== indexLigne || caseEnEdition.indexCase !== indexCase)) {
                annulerEditionCase();
                return; // Attendre le prochain click pour cette case
            }

            let contrainte = contraintesDico[indexLigne];
            let btn = event.currentTarget;

            // Double-clic = toujours passer en mode √©dition
            activerEditionCase(indexLigne, indexCase, btn);
        }

        // Cycler les couleurs (simple clic)
        function cyclerCouleurContrainte(indexLigne, indexCase, event) {
            let contrainte = contraintesDico[indexLigne];
            let btn = event.currentTarget;

            // Si la case n'a pas de lettre, passer en mode √©dition
            if (!contrainte.lettres[indexCase]) {
                activerEditionCase(indexLigne, indexCase, btn);
                return;
            }

            // Si la case est blanche (neutre), passer en rouge
            if (!contrainte.etats[indexCase]) {
                contrainte.etats[indexCase] = '=';
                btn.classList.add('bien-placee');
                filtrerDictionnaire();
            } else {
                // Sinon, cycler l'√©tat: '=' (rouge) -> '?' (jaune) -> '_' (bleu) -> '' (blanc)
                let etats = ['=', '?', '_'];
                let etatActuel = contrainte.etats[indexCase];
                let indexEtat = etats.indexOf(etatActuel);

                if (indexEtat === etats.length - 1) {
                    // Apr√®s bleu, retour en blanc (neutre)
                    contrainte.etats[indexCase] = '';
                    btn.classList.remove('bien-placee', 'mal-placee', 'absente');
                    filtrerDictionnaire();
                } else {
                    // Passer √† l'√©tat suivant
                    let nouvelEtat = etats[indexEtat + 1];
                    contrainte.etats[indexCase] = nouvelEtat;

                    // Mettre √† jour l'apparence du bouton directement sans reconstruire la grille
                    btn.classList.remove('bien-placee', 'mal-placee', 'absente');
                    if (nouvelEtat === '=') {
                        btn.classList.add('bien-placee');
                    } else if (nouvelEtat === '?') {
                        btn.classList.add('mal-placee');
                    } else if (nouvelEtat === '_') {
                        btn.classList.add('absente');
                    }

                    // Filtrer le dictionnaire sans reconstruire la grille
                    filtrerDictionnaire();
                }
            }
        }

        // Activer le mode √©dition pour une case
        function activerEditionCase(indexLigne, indexCase, btn) {
            // D√©sactiver l'√©dition pr√©c√©dente si elle existe
            if (caseEnEdition) {
                annulerEditionCase();
            }

            caseEnEdition = { indexLigne, indexCase };

            // Changer l'apparence du bouton
            btn.classList.add('edition');
            btn.innerHTML = '';

            // Cr√©er un input pour saisir la lettre
            let input = document.createElement('input');
            input.type = 'text';
            input.maxLength = 1;
            input.value = contraintesDico[indexLigne].lettres[indexCase] || '';
            input.style.cssText = 'width: 100%; height: 100%; border: none; background: transparent; text-align: center; font-size: inherit; font-weight: inherit; text-transform: uppercase; outline: none;';

            btn.appendChild(input);

            // Focus automatique et s√©lection du texte pour faciliter le remplacement
            // Doit √™tre appel√© APR√àS l'ajout au DOM
            input.focus();
            input.select();

            // G√©rer la saisie
            input.addEventListener('input', (e) => {
                let val = e.target.value.toUpperCase();
                if (val && (val < 'A' || val > 'Z')) {
                    e.target.value = '';
                    return;
                }
                e.target.value = val;

                // Si une lettre a √©t√© saisie, la sauvegarder et passer √† la case suivante
                if (val) {
                    contraintesDico[indexLigne].lettres[indexCase] = val;
                    contraintesDico[indexLigne].etats[indexCase] = ''; // √âtat neutre (blanc) par d√©faut
                    caseEnEdition = null;

                    // Passer √† la case suivante si elle existe
                    if (indexCase < longueurDicoSelectionnee - 1) {
                        afficherGrilleContraintes();
                        // Pas de filtrage pour l'√©tat neutre
                        // Activer automatiquement la case suivante
                        setTimeout(() => {
                            let grilleContraintes = document.getElementById('grilleContraintes');
                            let lignes = grilleContraintes.querySelectorAll('.ligne-tentative');
                            if (lignes[indexLigne]) {
                                let boutons = lignes[indexLigne].querySelectorAll('.lettre-btn');
                                if (boutons[indexCase + 1]) {
                                    boutons[indexCase + 1].click();
                                }
                            }
                        }, 10);
                    } else {
                        // Derni√®re case de la ligne, juste reconstruire
                        afficherGrilleContraintes();
                    }
                }
            });

            // Variable pour √©viter les doubles validations
            let validationEnCours = false;

            // G√©rer la validation (Enter ou perte de focus)
            let valider = () => {
                if (validationEnCours) return;
                validationEnCours = true;

                let lettre = input.value.trim().toUpperCase();
                if (lettre) {
                    contraintesDico[indexLigne].lettres[indexCase] = lettre;
                    contraintesDico[indexLigne].etats[indexCase] = ''; // √âtat neutre (blanc) par d√©faut
                } else {
                    // Si l'input est vide, effacer la case compl√®tement
                    contraintesDico[indexLigne].lettres[indexCase] = '';
                    contraintesDico[indexLigne].etats[indexCase] = '';
                }
                caseEnEdition = null;

                // Reconstruire la grille pour sortir du mode √©dition
                afficherGrilleContraintes();
                // Pas de filtrage pour l'√©tat neutre
            };

            input.addEventListener('blur', valider);
            input.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    e.preventDefault();
                    valider();
                }
            });

            // G√©rer la touche Backspace/Delete pour effacer
            input.addEventListener('keydown', (e) => {
                if (e.key === 'Backspace' || e.key === 'Delete') {
                    // Laisser l'input g√©rer la suppression normalement
                    // Si l'input devient vide, la case sera effac√©e lors de la validation
                }
            });
        }

        // Annuler le mode √©dition
        function annulerEditionCase() {
            if (caseEnEdition) {
                // Sauvegarder la valeur actuelle de l'input s'il existe
                let input = document.querySelector('.lettre-btn.edition input');
                if (input) {
                    let lettre = input.value.trim().toUpperCase();
                    if (lettre) {
                        contraintesDico[caseEnEdition.indexLigne].lettres[caseEnEdition.indexCase] = lettre;
                        contraintesDico[caseEnEdition.indexLigne].etats[caseEnEdition.indexCase] = '=';
                    } else {
                        contraintesDico[caseEnEdition.indexLigne].lettres[caseEnEdition.indexCase] = '';
                        contraintesDico[caseEnEdition.indexLigne].etats[caseEnEdition.indexCase] = '';
                    }
                }
                caseEnEdition = null;
                afficherGrilleContraintes();
                filtrerDictionnaire();
            }
        }

        // Ajouter une ligne de contrainte
        function ajouterLigneContrainte() {
            contraintesDico.push({
                lettres: new Array(longueurDicoSelectionnee).fill(''),
                etats: new Array(longueurDicoSelectionnee).fill('')
            });

            afficherGrilleContraintes();
        }

        // Supprimer une contrainte
        function supprimerContrainte(index) {
            contraintesDico.splice(index, 1);
            afficherGrilleContraintes();
            filtrerDictionnaire();
        }

        // Filtrer le dictionnaire selon les contraintes
        function filtrerDictionnaire() {
            if (dictionnaire.length === 0) {
                document.getElementById('affichageDico').value = 'Dictionnaire non charg√©.';
                document.getElementById('compteurMots').textContent = '';
                return;
            }

            let motsAffiches = dictionnaire;

            // Filtrer par longueur
            if (longueurDicoSelectionnee > 0) {
                motsAffiches = motsAffiches.filter(mot => mot.length === longueurDicoSelectionnee);
            }

            // Appliquer TOUTES les contraintes de TOUTES les lignes
            // Chaque mot doit satisfaire TOUTES les contraintes
            motsAffiches = motsAffiches.filter(mot => {
                // Le mot doit respecter chaque ligne de contrainte
                return contraintesDico.every(contrainte => {
                    return motRespectedContrainte(mot, contrainte);
                });
            });

            console.log(`R√©sultat final du filtrage: ${motsAffiches.length} mots`);
            document.getElementById('affichageDico').value = motsAffiches.join('\n');
            document.getElementById('compteurMots').textContent = `Nombre de mots : ${motsAffiches.length}`;
        }

        // V√©rifier si un mot respecte une contrainte
        function motRespectedContrainte(mot, contrainte) {
            // V√©rifier si la contrainte a au moins une lettre avec un √©tat actif (pas vide et pas neutre)
            let aContrainteActive = false;
            for (let i = 0; i < contrainte.lettres.length; i++) {
                if (contrainte.lettres[i] && contrainte.etats[i]) {
                    aContrainteActive = true;
                    break;
                }
            }

            // Si aucune contrainte active, la ligne est neutre et accepte tous les mots
            if (!aContrainteActive) {
                console.log('Contrainte neutre d√©tect√©e - accepte tous les mots');
                return true;
            }

            // Debug: afficher les contraintes actives
            let contraintesActives = [];
            for (let i = 0; i < contrainte.lettres.length; i++) {
                if (contrainte.lettres[i] && contrainte.etats[i]) {
                    contraintesActives.push(`${contrainte.lettres[i]}(${contrainte.etats[i]})`);
                }
            }
            if (contraintesActives.length > 0) {
                console.log('Contraintes actives:', contraintesActives.join(', '));
            }

            let lettresMalPlacees = [];
            let lettresAbsentesGlobales = new Set(); // Lettres qui n'apparaissent nulle part

            // Collecter toutes les positions o√π chaque lettre appara√Æt dans la contrainte
            let lettresPositions = {};
            for (let i = 0; i < contrainte.lettres.length; i++) {
                let lettre = contrainte.lettres[i];
                let etat = contrainte.etats[i];
                if (!lettre) continue;

                if (!lettresPositions[lettre]) {
                    lettresPositions[lettre] = [];
                }
                lettresPositions[lettre].push({ position: i, etat: etat });
            }

            // V√©rifier chaque lettre de la contrainte
            for (let i = 0; i < contrainte.lettres.length; i++) {
                let lettre = contrainte.lettres[i];
                let etat = contrainte.etats[i];

                if (!lettre) continue; // Case vide
                if (!etat) continue; // √âtat neutre (blanc) - pas de contrainte

                if (etat === '=') {
                    // Lettre bien plac√©e : doit √™tre √† cette position exacte
                    if (mot[i] !== lettre) {
                        return false;
                    }
                } else if (etat === '_') {
                    // Lettre absente √Ä CETTE POSITION
                    // V√©rifier si cette lettre n'a QUE des marquages absents (pas de = ou ?)
                    let tousEtatsLettre = lettresPositions[lettre];
                    let aEtatNonAbsent = tousEtatsLettre.some(info => info.etat !== '_' && info.etat !== '');

                    if (!aEtatNonAbsent) {
                        // Si toutes les occurrences sont absentes, la lettre ne doit pas √™tre dans le mot
                        if (mot.includes(lettre)) {
                            return false;
                        }
                    } else {
                        // Sinon, juste v√©rifier que la lettre n'est pas √† cette position
                        if (mot[i] === lettre) {
                            return false;
                        }
                    }
                } else if (etat === '?') {
                    // Lettre mal plac√©e : doit √™tre dans le mot mais pas √† cette position
                    lettresMalPlacees.push({ lettre, position: i });
                }
            }

            // V√©rifier les lettres mal plac√©es
            for (let info of lettresMalPlacees) {
                if (!mot.includes(info.lettre)) {
                    return false; // La lettre doit √™tre dans le mot
                }
                if (mot[info.position] === info.lettre) {
                    return false; // La lettre ne doit pas √™tre √† cette position
                }
            }

            return true;
        }

        // Afficher le dictionnaire (pour le chargement initial)
        function afficherDictionnaire() {
            filtrerDictionnaire();
        }

        // Fonction pour r√©initialiser les filtres du dictionnaire
        function reinitialiserFiltreDico() {
            document.getElementById('longueurDico').value = '6';
            longueurDicoSelectionnee = 0;
            contraintesDico = [];
            document.getElementById('filtresDicoSection').classList.add('hidden');
            document.getElementById('grilleContraintes').innerHTML = '';
            document.getElementById('btnInitDico').textContent = 'Initialiser';
            afficherDictionnaire();
        }
    </script>
</body>
</html>
